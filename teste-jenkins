pipeline {
    agent any
    options { disableConcurrentBuilds() }
    environment {
        SVN_URL = 'https://svn.code.sf.net/p/acbr/code/trunk2/Projetos'
        DOCKER_IMAGE = 'ubuntu:latest'
    }
    stages {
        stage('Set Workspace') {
            steps {
                ws('/var/jenkins_home/workspace/Teste-Pipeline') {
                    sh 'echo "Caminho do workspace: $WORKSPACE"'
                    sh 'touch HelloWorld.txt'
                }
            }
        }
        stage('SVN') {
            steps {
                script {
                    checkout([
                        $class: 'SubversionSCM',
                        locations: [[remote: SVN_URL]],
                        workspaceUpdater: [$class: 'UpdateWithCleanUpdater']
                    ])
                }
            }
        }
        stage('teste-1') {
            steps {
                sh 'pwd'
                sh 'ls -lha ${WORKSPACE}'
            }
        }
        stage('teste-docker') {
            agent {
                docker {
                    image DOCKER_IMAGE
                    args """
                        --privileged
                        -v /var/jenkins_home/workspace/Teste-Pipeline:/workspace
                        -w /workspace
                    """
                }
            }
            steps {
                sh 'ls -lha'
                sh 'pwd'
                sh 'ls -lha /workspace'
            }
        }
    }
}
